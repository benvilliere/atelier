<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Atelier</title>
    <link rel="stylesheet" href="reset.css" />
    <link rel="stylesheet" href="styles.css" />
    <script src="//unpkg.com/alpinejs" defer></script>
  </head>
  <body>
    <div
      class="container"
      x-data="{ timeline: [] }"
      x-init="timeline = await (await fetch('/timeline')).json()"
      x-init="
        fetch('/timeline')
          .then(res => res.json())
          .then(res => {
            timeline = res.timeline
          })
      "
    >
      <pre
        x-data="{ show: true }"
        @dblclick="show = false"
        x-show="show"
        style="
          position: fixed;
          top: 1vw;
          left: 1vw;
          z-index: 999;
          padding: 2vw;
          background: rgba(255, 255, 255, 0.95);
          font-family: monospace;
          font-size: 16px;
          line-height: 140%;
          color: rgba(0, 0, 0, 0.9);
          border-radius: 0.5vw;
        "
        x-text="JSON.stringify(timeline, null, 2)"
      ></pre>
      <div class="deck" x-show="timeline.length > 0">
        <template x-for="(entry, index) in timeline">
          <div
            class="card"
            :style="{ transform: `scale(${1 - (index) * 0.1})`, top: (index + 1) * -10, zIndex: 100 - (index + 1) }"
            :style="{ transform: `scale(${1 - (index) * 0.1})`, top: `${-(index + 1) * 10}px`, zIndex: 100 - (index + 1) }"
          >
            <div class="header">
              <span x-text="index"></span>
            </div>
            <div class="media">
              <img :src="`/screenshots/${entry.screenshot}`" />
            </div>
            <div class="actions">
              <form
                class="action"
                x-show="entry.commitHash != ''"
                :action="`/revert/${entry.commitHash}`"
                method="get"
              >
                <button type="submit" @click="$el.closest('.card').remove()">
                  Revert and destroy
                </button>
              </form>
              <form
                class="action"
                :action="`/delete/${entry.timestamp}`"
                method="post"
              >
                <button type="submit" @click="$el.closest('.card').remove()">
                  Delete
                </button>
              </form>
            </div>
          </div>
        </template>
      </div>
      <div class="controls">
        <button class="up">up</button>
        <button class="down">down</button>
      </div>
    </div>
  </body>
</html>
