<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Atelier</title>
    <link rel="stylesheet" href="reset.css" />
    <link rel="stylesheet" href="styles.css" />
    <script src="//unpkg.com/alpinejs" defer></script>
  </head>
  <body>
    <div
      class="container"
      x-data="{ timeline: [] }"
      x-init="timeline = await (await fetch('/timeline')).json()"
      x-init="
        fetch('/timeline')
          .then(res => res.json())
          .then(res => {
            timeline = res.timeline
          })
      "
    >
      <pre
        x-data="{ show: false }"
        @dblclick="show = false"
        x-show="show"
        class="debugger"
        x-text="JSON.stringify(timeline, null, 2)"
      ></pre>
      <div class="deck" x-show="timeline.length > 0">
        <template x-for="(entry, index) in timeline">
          <div class="card">
            <div class="actions">
              <span x-text="index"></span>
              <span x-text="entry.timestamp"></span>
              <form
                class="action"
                x-show="entry.commitHash != ''"
                :action="`/revert/${entry.commitHash}`"
                method="get"
              >
                <button
                  type="submit"
                  @click="
                    $el.closest('.card').remove();
                    timeline = [entry, ...timeline];
                    window.scrollTo(0, 0);
                  "
                >
                  Revert
                </button>
              </form>
              <form
                class="action"
                :action="`/delete/${entry.timestamp}`"
                method="post"
              >
                <button type="submit" @click="$el.closest('.card').remove()">
                  &times;
                </button>
              </form>
            </div>
            <div class="media">
              <img :src="`/screenshots/${entry.screenshot}`" />
            </div>
          </div>
        </template>
      </div>
      <!-- <div class="controls">
        <button class="up">up</button>
        <button class="down">down</button>
      </div> -->
    </div>
  </body>
</html>
